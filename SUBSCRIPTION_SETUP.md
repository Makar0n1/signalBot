# üîê –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫ –∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ](#—á—Ç–æ-–±—ã–ª–æ-—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
2. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
3. [–ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞](#–∑–∞–ø—É—Å–∫-–ø—Ä–æ–µ–∫—Ç–∞)
4. [–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å](#–∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å)
5. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è NOWPayments](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-nowpayments)
6. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)

---

## ‚ú® –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. **–°–∏—Å—Ç–µ–º–∞ —Ç—Ä–∏–∞–ª–∞ (24 —á–∞—Å–∞)**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è —Ç—Ä–∏–∞–ª–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ç—Ä–∏–∞–ª–∞
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Ç—Ä–∏–∞–ª–∞

### 2. **–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫**
- ‚úÖ –ú–æ–¥–µ–ª—å –ø–æ–¥–ø–∏—Å–∫–∏ —Å –¥–∞—Ç–∞–º–∏ –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è
- ‚úÖ Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ
- ‚úÖ –°—Ç–æ–∏–º–æ—Å—Ç—å: $10/–º–µ—Å—è—Ü (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

### 3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è NOWPayments**
- ‚úÖ –°–µ—Ä–≤–∏—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ Webhook handler –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –ø–ª–∞—Ç–µ–∂–∞—Ö
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ BTC, ETH, USDT (TRC20/ERC20)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

### 4. **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å**
- ‚úÖ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ë–∞–Ω/—Ä–∞–∑–±–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –†—É—á–Ω–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
- ‚úÖ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω-–ø—Ä–∞–≤
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏, —Ç—Ä–∏–∞–ª—ã –∏ —Ç.–¥.)

### 5. **Telegram Bot UI**
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–û–ø–ª–∞—Ç–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É"
- ‚úÖ –í—ã–±–æ—Ä –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –∏ —Å—É–º–º—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ .env.example –≤ .env
```bash
cp .env.example .env
```

### 2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ .env

```env
# MongoDB
MONGODB_URI=mongodb://localhost:27017/signalbot

# Telegram Bot
BOT_TOKEN=your_telegram_bot_token_here
MAIN_ADMIN_TG_USER_ID=your_telegram_user_id

# Admin Dashboard
ADMIN_PORT=3000

# NOWPayments
NOWPAYMENTS_API_KEY=your_nowpayments_api_key_here
IPN_CALLBACK_URL=https://yourdomain.com/webhooks/nowpayments

# Subscription Settings
SUBSCRIPTION_PRICE_USD=10
TRIAL_DURATION_HOURS=24
```

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞ NOWPayments

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [NOWPayments](https://nowpayments.io/)
2. –°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ IPN (Instant Payment Notification):
   - URL: `https://yourdomain.com/webhooks/nowpayments`
   - –í–∫–ª—é—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–ª–∞—Ç–µ–∂–µ–π

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
npm install
```

### –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
```bash
npm start
```

### –ó–∞–ø—É—Å–∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
```bash
npm run admin
```

### –ó–∞–ø—É—Å–∫ –æ–±–æ–∏—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–≤ —Ä–∞–∑–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö)
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1
npm start

# –¢–µ—Ä–º–∏–Ω–∞–ª 2
npm run admin
```

---

## üéõÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

### –î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ `npm run admin` –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
http://localhost:3000
```

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### 1. –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (`/`)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–∞ —Ç—Ä–∏–∞–ª–µ
- –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

#### 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (`/users`)
- **–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:
  - User ID
  - Username
  - –°—Ç–∞—Ç—É—Å (–¢—Ä–∏–∞–ª/–ü–æ–¥–ø–∏—Å–∫–∞/–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞/–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)
  - –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç—Ä–∏–∞–ª–∞
  - –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
- **–ü–æ–∏—Å–∫** –ø–æ User ID –∏–ª–∏ username
- **–î–µ–π—Å—Ç–≤–∏—è**:
  - üö´ –ó–∞–±–∞–Ω–∏—Ç—å/‚úÖ –†–∞–∑–±–∞–Ω–∏—Ç—å
  - ‚ûï –ü—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É (—Ä—É—á–Ω–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –Ω–∞ N –¥–Ω–µ–π)

#### 3. API Endpoints

##### Users API
```http
GET /api/users?page=1&limit=20&search=username
GET /api/users/:userId
PATCH /api/users/:userId/ban
PATCH /api/users/:userId/admin
PATCH /api/users/:userId/subscription
DELETE /api/users/:userId
```

##### Payments API
```http
GET /api/payments?page=1&limit=20
GET /api/payments/user/:userId
```

##### Webhooks
```http
POST /webhooks/nowpayments
```

---

## üí≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è NOWPayments

### –ü–æ—Ç–æ–∫ –æ–ø–ª–∞—Ç—ã

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–û–ø–ª–∞—Ç–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É"**
   - –ë–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤—ã–±—Ä–∞—Ç—å –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É

2. **–í—ã–±–æ—Ä –≤–∞–ª—é—Ç—ã**
   - ‚Çø Bitcoin (BTC)
   - Œû Ethereum (ETH)
   - ‚ÇÆ USDT (TRC20)
   - ‚ÇÆ USDT (ERC20)

3. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞**
   - –ó–∞–ø—Ä–æ—Å –∫ NOWPayments API
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –≤ –ë–î
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –∏ —Å—É–º–º—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã

4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É**
   - –ù–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å
   - –¢–æ—á–Ω—É—é —É–∫–∞–∑–∞–Ω–Ω—É—é —Å—É–º–º—É

5. **Webhook –æ—Ç NOWPayments**
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ –ø–ª–∞—Ç–µ–∂–∞
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ –ë–î
   - –ü—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ `finished` –∏–ª–∏ `confirmed` - –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏

6. **–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏**
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `subscription_active = true`
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `subscription_expires_at = +30 –¥–Ω–µ–π`
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "‚úÖ –Ø –æ–ø–ª–∞—Ç–∏–ª" –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞ –≤—Ä—É—á–Ω—É—é.

---

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### User Model (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è)
```typescript
{
  user_id: Number,
  username: String,
  language_code: String,

  // –¢—Ä–∏–∞–ª
  trial_started_at: Date,
  trial_expires_at: Date,

  // –ü–æ–¥–ø–∏—Å–∫–∞
  subscription_active: Boolean,
  subscription_expires_at: Date,

  // –ë–∞–Ω
  is_banned: Boolean,

  created_at: Date,
  updated_at: Date
}
```

### Payment Model (–Ω–æ–≤–∞—è)
```typescript
{
  user_id: Number,
  payment_id: String,        // ID –ø–ª–∞—Ç–µ–∂–∞ –æ—Ç NOWPayments
  amount: Number,            // –°—É–º–º–∞ –≤ USD
  currency: String,          // USD
  status: String,            // waiting, confirming, finished, etc.
  pay_address: String,       // –ê–¥—Ä–µ—Å –¥–ª—è –æ–ø–ª–∞—Ç—ã
  pay_amount: Number,        // –°—É–º–º–∞ –≤ –∫—Ä–∏–ø—Ç–µ
  pay_currency: String,      // BTC, ETH, USDT –∏ —Ç.–¥.
  order_id: String,
  created_at: Date,
  updated_at: Date
}
```

---

## üîß Middleware –∏ —Å–µ—Ä–≤–∏—Å—ã

### Subscription Middleware

#### `initializeTrial`
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç—Ä–∏–∞–ª –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –±–æ—Ç–∞.

#### `checkSubscription`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∏–º–µ–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É –∏–ª–∏ —Ç—Ä–∏–∞–ª. –ï—Å–ª–∏ –Ω–µ—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π –æ–ø–ª–∞—Ç—ã.

#### `hasAccess`
–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö).

### Payment Service

#### `createPayment({ user_id, amount, currency })`
–°–æ–∑–¥–∞—ë—Ç –ø–ª–∞—Ç—ë–∂ —á–µ—Ä–µ–∑ NOWPayments API.

#### `getPaymentStatus(paymentId)`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞.

#### `handleWebhook(webhookData)`
–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç webhook –æ—Ç NOWPayments.

#### `activateSubscription(user_id)`
–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ 30 –¥–Ω–µ–π.

---

## üìù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –±–æ—Ç–µ

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º handlers

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∫–∏ –∫ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º –∫–æ–º–∞–Ω–¥–∞–º:

```typescript
import { checkSubscription } from "../middlewares/subscription.middleware";

bot.hears("üìà OI Screener",
  isUser,
  checkSubscription,  // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∫–∏
  async (ctx) => {
    // ... –≤–∞—à –∫–æ–¥
  }
);
```

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö

```typescript
import { hasAccess } from "../middlewares/subscription.middleware";

const userHasAccess = await hasAccess(userId);
if (!userHasAccess) {
  // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞
  return;
}
```

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### NOWPayments Webhooks

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ webhook –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

```typescript
// –í routes/webhooks.ts
const verifyWebhookSignature = (req: Request): boolean => {
  const signature = req.headers['x-nowpayments-sig'];
  const secret = process.env.NOWPAYMENTS_IPN_SECRET;

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏
  // ...

  return true;
};
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ webhook
- [ ] –î–æ–±–∞–≤–∏—Ç—å email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø–ª–∞—Ç–µ–∂–µ–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏

---

## üí° –°–æ–≤–µ—Ç—ã

1. **–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ [ngrok](https://ngrok.com/) –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è webhooks –ª–æ–∫–∞–ª—å–Ω–æ
   ```bash
   ngrok http 3000
   ```

2. **–¢–µ—Å—Ç–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏**: NOWPayments –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç sandbox —Ä–µ–∂–∏–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Winston logger

4. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –†–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞–π—Ç–µ backup MongoDB

---

## ‚ùì FAQ

**Q: –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É –ø–æ–¥–ø–∏—Å–∫–∏?**
A: –ò–∑–º–µ–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `SUBSCRIPTION_PRICE_USD` –≤ `.env`

**Q: –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–∏–∞–ª–∞?**
A: –ò–∑–º–µ–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `TRIAL_DURATION_HOURS` –≤ `.env`

**Q: –ì–¥–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –ø–ª–∞—Ç–µ–∂–µ–π?**
A: –í –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ –≤ —Ñ–∞–π–ª–µ `error.log` (–µ—Å–ª–∏ `NODE_ENV=production`)

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É?**
A: –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π handler –≤ `subscriptionHandler.ts` –∏ –Ω–æ–≤—É—é –∫–Ω–æ–ø–∫—É –≤ inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ issues –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.
